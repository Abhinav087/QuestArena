<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuestArena: Target Save the Partner</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Press+Start+2P&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <!-- Header / HUD -->
        <header id="game-hud" class="hidden">
            <div class="hud-item">Level: <span id="level-display">0</span></div>
            <div class="hud-item">Timer: <span id="timer-display">30:00</span></div>
            <div class="hud-item">Score: <span id="score-display">0</span></div>
            <div class="hud-item">Status: <span id="hud-status">Talk to the NPC</span></div>
        </header>

        <!-- Main Content Area -->
        <main>
            <!-- Login Screen -->
            <section id="login-screen" class="active">
                <h1>QUEST ARENA</h1>
                <p>Target: Save the Partner</p>
                <input type="text" id="team-name" placeholder="Enter Team Name">
                <button onclick="startGame()">ENTER THE ARENA</button>
            </section>

            <!-- Waiting Lobby Screen (NEW) -->
            <section id="waiting-screen" class="hidden">
                <div class="waiting-icon">⏳</div>
                <h2>WAITING FOR SERVER</h2>
                <p class="waiting-text">The game master hasn't started the timer yet.</p>
                <p class="waiting-sub">You are connected as: <strong id="waiting-team-name"></strong></p>
                <div class="waiting-players">
                    <span id="waiting-player-count">0</span> players connected
                </div>
                <div class="waiting-pulse-bar"></div>
                <p class="waiting-hint">The game will begin automatically once the server admin starts the timer.</p>
            </section>

            <!-- Story / Context Screen -->
            <section id="story-screen" class="hidden">
                <h2>Mission Briefing</h2>
                <p id="story-text">
                    The Principal captured your partner inside the college building.
                    Defeat each floor boss by clearing their challenge and reach the top floor.
                    You only have one shot to save your love story.
                </p>
                <button onclick="startMission()">START MISSION</button>
            </section>

            <section id="level-intro-screen" class="hidden">
                <h2 id="level-intro-title">Level Intro</h2>
                <p id="level-intro-dialogue"></p>
                <button onclick="continueLevelIntro()">CONTINUE</button>
            </section>

            <section id="hidden-route-screen" class="hidden">
                <h2>Unknown Voice</h2>
                <p id="hidden-route-text">
                    "Are you looking for your Mithrabindha?" — a voice echoes near the stairs.
                </p>
                <div class="path-options">
                    <button onclick="handleHiddenRoute('investigate')" class="path-btn hard">Investigate Voice</button>
                    <button onclick="handleHiddenRoute('ignore')" class="path-btn easy">Ignore and Continue</button>
                </div>
            </section>

            <section id="arena-screen" class="hidden">
                <h2 id="arena-level-title">Level 0 — College Gate</h2>
                <canvas id="arena-canvas" width="1920" height="1080"></canvas>
                <p id="arena-hint">WASD / Arrow Keys to move. Press E/Enter near NPCs.</p>
                <div id="arena-interact-prompt" class="hidden"></div>
                <div id="arena-interact-prompt-list" class="hidden"></div>
                <div id="arena-dialogue" class="hidden">
                    <h3 id="arena-dialogue-speaker">NPC</h3>
                    <p id="arena-dialogue-text"></p>
                    <button onclick="continueArenaDialogue()">Continue</button>
                </div>
            </section>

            <div id="modal-backdrop" class="hidden"></div>

            <!-- Level Selection / Path Choice -->
            <section id="path-selection" class="hidden">
                <h2 id="path-title">Choose Your Path</h2>
                <div class="path-options">
                    <button onclick="choosePath('easy')" class="path-btn easy">Easy Path</button>
                    <button onclick="choosePath('hard')" class="path-btn hard">Hard Path</button>
                    <button id="backlog-btn" onclick="choosePath('backlog_king')" class="path-btn hidden-btn" style="display:none;">???</button> 
                </div>
            </section>

            <!-- Question Display -->
            <section id="question-screen" class="hidden">
                <h2 id="question-title">Level 0</h2>
                <div id="question-container">
                    <!-- Dynamic Question Content -->
                </div>
                <button id="submit-answer-btn" type="button" onclick="submitAnswer()">Submit Answer</button>
            </section>

            <!-- Coding Challenge Screen (Level 5) -->
            <section id="coding-screen" class="hidden">
                <h2>FINAL BOSS: Coding Challenge</h2>
                <p id="coding-problem-text"></p>
                <textarea id="code-editor" rows="15" placeholder="# Write your Python code here..."></textarea>
                <button onclick="submitCode()">COMPILE & EXECUTE</button>
                <div id="code-result"></div>
            </section>

            <!-- Game Over / Victory Screen -->
            <section id="end-screen" class="hidden">
                <h1 id="end-title">MISSION ACCOMPLISHED</h1>
                <p>Final Score: <span id="final-score">0</span></p>
                <p id="end-message"></p>
            </section>
        </main>
    </div>

    <div id="fade-overlay"></div>

    <script src="script.js"></script>
</body>
</html>
